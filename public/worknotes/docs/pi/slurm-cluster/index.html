<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Setting Up Raspberry Pi Slurm Cluster # Flash disk(s) with raspberry pi lite. Insert disk(s) into pi(s) and power them on.
Run sudo raspi-config
update raspi-config change hostname setup ssh change password for pi user set wlan locale set timezone setup login-less ssh between nodes.
create key on one of the nodes
sudo ssh-keygen # save it somewhere central like in /etc/ssh configure ssh to use the newly created key by editing /etc/ssh/ssh_config and adding">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Setting Up Raspberry Pi Slurm Cluster" />
<meta property="og:description" content="Setting Up Raspberry Pi Slurm Cluster # Flash disk(s) with raspberry pi lite. Insert disk(s) into pi(s) and power them on.
Run sudo raspi-config
update raspi-config change hostname setup ssh change password for pi user set wlan locale set timezone setup login-less ssh between nodes.
create key on one of the nodes
sudo ssh-keygen # save it somewhere central like in /etc/ssh configure ssh to use the newly created key by editing /etc/ssh/ssh_config and adding" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/worknotes/docs/pi/slurm-cluster/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2023-03-18T01:36:43+11:00" />
<title>Setting Up Raspberry Pi Slurm Cluster | Ed&#39;s Space - Notes</title>
<link rel="manifest" href="/worknotes/manifest.json">
<link rel="icon" href="/worknotes/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/worknotes/book.min.16fde4d05cd1cf758f445b62581a359a2b0aa3a8b1be4966bf73546658560a86.css" >
  <script defer src="/worknotes/flexsearch.min.js"></script>
  <script defer src="/worknotes/en.search.min.289065163c3f720737165922e5d06dc0eb2a1d836622a1268993f36bb6ea5de8.js" ></script>

  <script defer src="/worknotes/sw.min.97afbbb840f8817a158b86f13f6a071d4ddf793bff2b4832f0bea2832fcea52b.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/worknotes/"><span>Ed&#39;s Space - Notes</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/caf/" class="">Coarray Fortran Things</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e119a32310022f62d4c06c8f517eac24" class="toggle"  />
    <label for="section-e119a32310022f62d4c06c8f517eac24" class="flex justify-between">
      <a role="button" class="">Useful code snippets</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/useful/fixed-cutoff-direct-pair-search/" class="">Direct pair search</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/useful/fixed-cutoff-cell-lists-pair-search/" class="">Cell list pair search</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/useful/grid-rows-spatial-hashing/" class="">grid dimension hashing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/useful/z-curve-spatial-hashing/" class="">Z-curve hashing</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c8691a4179c494de8628c8e1b64ba030" class="toggle"  />
    <label for="section-c8691a4179c494de8628c8e1b64ba030" class="flex justify-between">
      <a role="button" class="">CUDA Programming</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/cuda-wsl/" class="">CUDA &#43; NVHPC on WSL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/" class="">nvfortran and nvc&#43;&#43; reference codes</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/deviceQuery/" class="">deviceQuery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/precision_m/" class="">precision_m</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/error/" class="">Error Handling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/limitingFactor/" class="">limitingFactor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/peakBandwidth/" class="">peakBandwidth</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/bandwidthTest/" class="">bandwidthTest</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/MemCpy/" class="">MemCpy</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/testAsync/" class="">testAsync</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/offsetNStride/" class="">offsetNStride</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/strideTexture/" class="">strideTexture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/sharedExample/" class="">sharedExample</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/checkP2pAccess/" class="">checkP2PAccess</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/directTransfer/" class="">directTransfer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/p2pBandwidth/" class="">p2pBandwidth</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/mpiDevices/" class="">mpiDevices</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/mpiDeviceUtil/" class="">mpiDeviceUtil</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cuda/reference-codes/transposeMPI/" class="">transposeMPI</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-51c3f533883c549c0f1c5f4960205a5e" class="toggle"  />
    <label for="section-51c3f533883c549c0f1c5f4960205a5e" class="flex justify-between">
      <a href="/worknotes/docs/cfdem/" class="">CFDEM</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cfdem/snappyhexmesh/" class="">Snappy Hex Mesh Basics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/cfdem/liggghts-intel-comp/" class="">Speeding Up LIGGGHTS with Intel Compilers and Compiler Options</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c720b4cbfe3c820847227813f65aa57d" class="toggle" checked />
    <label for="section-c720b4cbfe3c820847227813f65aa57d" class="flex justify-between">
      <a role="button" class="">Raspberry Pis</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/pi/trim-jetsonnano/" class="">Reducing Jetson Nano OS for Server</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/pi/webserver/" class="">Setting Up Public Webserver on Raspberry Pi</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/worknotes/docs/pi/slurm-cluster/" class="active">Setting Up Raspberry Pi Slurm Cluster</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://github.com/edoyango"  target="_blank" rel="noopener">
        GitHub
      </a>
  </li>
  
  <li>
    <a href="https://ed-yang.com"  target="_blank" rel="noopener">
        Back to Home
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/worknotes/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Setting Up Raspberry Pi Slurm Cluster</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="setting-up-raspberry-pi-slurm-cluster">
  Setting Up Raspberry Pi Slurm Cluster
  <a class="anchor" href="#setting-up-raspberry-pi-slurm-cluster">#</a>
</h1>
<ol>
<li>
<p>Flash disk(s) with raspberry pi lite. Insert disk(s) into pi(s) and power them on.</p>
</li>
<li>
<p>Run <code>sudo raspi-config</code></p>
<ul>
<li>update raspi-config</li>
<li>change hostname</li>
<li>setup ssh</li>
<li>change password for pi user</li>
<li>set wlan locale</li>
<li>set timezone</li>
</ul>
</li>
<li>
<p>setup login-less ssh between nodes.</p>
<ul>
<li>
<p>create key on one of the nodes</p>
<pre><code>  sudo ssh-keygen # save it somewhere central like in /etc/ssh
</code></pre>
</li>
<li>
<p>configure ssh to use the newly created key by editing <code>/etc/ssh/ssh_config</code> and adding</p>
<pre><code> IdentityFile /etc/ssh/&lt;key name&gt;
</code></pre>
</li>
<li>
<p>make the key readable</p>
<pre><code>  chmod +r /etc/ssh/&lt;key name&gt;
</code></pre>
</li>
<li>
<p>for each other node, copy ssh key to the nodes (e.g. with <code>scp</code>) and repeat above steps.</p>
</li>
</ul>
</li>
<li>
<p>update <code>/etc/hosts</code> with all hosts names. e.g.:</p>
<pre><code> 10.0.0.1 pimananager
 10.0.0.2 picompute1
 10.0.0.3 picompute2
</code></pre>
</li>
<li>
<p>Setup dhcp server on manager/login node (detailed instructions)</p>
<ul>
<li>
<p>Install packages required for this step:</p>
<pre><code>  sudo apt install iptables dnsmasq
</code></pre>
</li>
<li>
<p>In <code>/etc/dhcpcd.conf</code>, add the following:</p>
<pre><code>  interface eth0 # for the ethernet network
  static ip_address=10.0.0.1/8 # provide static ip of 10.0.0.1
  static domain_name_servers=8.8.8.8,8.8.4.4 #???
  nolink # sets up the interface without being attached to ethernet

  move default config file and create new one with text below:

  sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.old
  sudo nano /etc/dnsmasq.conf

  interface=eth0
  listen-address=10.0.0.1
  dhcp-range=10.0.0.32,10.0.0.128,12h
  dhcp-host=&lt;mac-address of nodes&gt;,10.0.0.2
  dhcp-host=&lt;mac-address of nodes&gt;,10.0.0.3
  ...
  server=8.8.8.8
  server=8.8.4.4
  bind-interfaces
  domain-needed
  bogus-priv
  expand-hosts
</code></pre>
</li>
<li>
<p>add <code>sleep 10</code> to very start of <code>/etc/init.d/dnsmasq</code>. <strong>needs to be improved on</strong></p>
</li>
<li>
<p>reboot manager/login node</p>
</li>
<li>
<p>from <code>/etc/sysctl.conf</code>, uncomment <code>net.ipv4.ip_forward=1</code></p>
</li>
<li>
<p>Add iptables rules:</p>
<pre><code>  sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
  sudo iptables -A FORWARD -i wlan0 -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
  sudo iptables -A FORWARD -i eth0 -o wlan0 -j ACCEPT
</code></pre>
</li>
<li>
<p>ensure iptables rules are presistent between boots:</p>
<pre><code>  sudo apt install iptables-persistent
</code></pre>
</li>
<li>
<p>reboot switch and check DHCP leases were granted:</p>
<pre><code>  cat /var/lib/misc/dnsmasq.leases
</code></pre>
</li>
<li>
<p>Internet should be being forwarded to new nodes</p>
</li>
</ul>
</li>
<li>
<p>update existing packages on all nodes:</p>
<pre><code> sudo apt update; sudo apt upgrade -y; sudo apt update
</code></pre>
</li>
<li>
<p>packages to install:</p>
<pre><code> sudo apt install cmake tcl tcl-dev ntpdate tmux git slurm-wlm openmpi-bin openmpi-common libopenmpi3 \
     libopenmpi-dev git tree -y
</code></pre>
</li>
<li>
<p>turn off swapfiles (kills the sd card):</p>
<pre><code> sudo dphys-swapfile swapoff
 sudo dphys-swapfile uninstall
 sudo update-rc.d dphys-swapfile remove
</code></pre>
</li>
<li>
<p>Setup NFS for shared filesystem:</p>
<ul>
<li>
<p>on the node with the drive connected:</p>
<ul>
<li>
<p>install nfs server package:</p>
<pre><code>  sudo apt install nfs-kernel-server -y
</code></pre>
</li>
<li>
<p>identify partition with <code>lsblk</code> and corresponding UUID with <code>blkid</code></p>
</li>
<li>
<p>format disk:</p>
<pre><code>  sudo mkfs -t ext4 /dev/&lt;partition&gt;
</code></pre>
</li>
<li>
<p>make directory drive is to be mounted on:</p>
<pre><code>  sudo mkdir &lt;directory&gt;
</code></pre>
</li>
<li>
<p>mount drive by <code>sudo nano /etc/fstab</code> add the following:</p>
<pre><code>  UUID=&lt;UUID&gt; &lt;directory to mount to&gt; ext4 defaults 0 &lt;next integer in the list&gt;
</code></pre>
</li>
<li>
<p>export the nfs by editing <code>sudo nano /etc/exports/</code> and add the following</p>
<pre><code>  &lt;directory to export&gt; &lt;ip style&gt;/&lt;search format&gt;(rw,sync,no_root_squash,no_subtree_check)
</code></pre>
<p>examples:</p>
<pre><code>  /clusterfs 192.168.1.0/255.255.255.0(rw,sync,no_root_squash,no_subtree_check)
  /clusterfs 10.0.0.0/8.8.8.0(rw,sync,no_root_squash,no_subtree_check)
</code></pre>
</li>
<li>
<p>mount the drive and then export:</p>
<pre><code>  sudo mount -a
  sudo exportfs -a
</code></pre>
</li>
</ul>
</li>
<li>
<p>on the nodes not connect to the drive:</p>
<ul>
<li>
<p>install nfs common package:</p>
<pre><code>  sudo apt install nfs-common -y
</code></pre>
</li>
<li>
<p>make directory drive where nfs folder is to be located. For purposes of MPI programs, make the folder name the same on all nodes</p>
</li>
<li>
<p>mount drive by <code>sudo nano /etc/fstab</code> and add the following lines:</p>
<pre><code>  &lt;ip of node with drive&gt;:&lt;directory&gt; &lt;directory&gt; nfs defaults 0 &lt;next index&gt;
</code></pre>
</li>
<li>
<p>mount drive:</p>
<pre><code>  sudo mount -a
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>install spack on nfs and setup spack env to load for root</p>
<ul>
<li>
<p>Clone the Spack repo</p>
<pre><code>  cd /clusterfs
  git clone -c feature.manyFiles=true https://github.com/spack/spack.git
</code></pre>
</li>
<li>
<p>add spack setup script to root .bashrc by sudo nano /root/.bashrc and add:</p>
<pre><code>  . /share/spack/setup-env.sh
</code></pre>
<p><strong>(would prefer this to be setup system wide)</strong></p>
</li>
</ul>
</li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/commit/7daac53108f4650eb77a9816344969fd8e7c434d" title='Last modified by Edward Yang | March 18, 2023' target="_blank" rel="noopener">
      <img src="/worknotes/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>March 18, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/edit/main/exampleSite/content.en/docs/pi/slurm-cluster.md" target="_blank" rel="noopener">
      <img src="/worknotes/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>
</html>












