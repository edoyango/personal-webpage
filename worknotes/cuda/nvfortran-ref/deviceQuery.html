<!doctype html>
<html>
	<head>
		<title>Ed Space - Worknotes - CUDA</title>
		<link href="/css/general.css" rel="stylesheet">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		<link href="/css/fortran-syntax.css" rel="stylesheet">
	</head>
	<body>
	
		<!-- Top navigation bar -->
		<nav class="navbar navbar-default sticky-top">
			<div class="container-fluid">
				<ul class="nav navbar-nav">
					<li class="nav-item"><a href="/index.html">Home</a></li>
					<li class="nav-item"><a href="/about.html">About Me</a></li>
					<li class="nav-item active"><a href="/worknotes/index.html">Work Notes</a></li>
					<li class="nav-item"><a href="/trips/index.html">Trips</a></li>
					<li class="nav-item"><a href="/apps/index.html">Web Tools</a></li>
		  		</ul>
			</div>
		</nav>
		
		<div class="normalwidth">
			<h1>Device Query</h1>
			<p>Function to query the properties of the NVIDIA GPUs detected on the system.</p>
            <p><a href="samples/deviceQuery.cuf" download="deviceQuery.cuf">Download link</a></p>
            <pre><code><span class="fstd">program</span> deviceQuery

    <span class="fstd">use</span> cudafor
    
    <span class="fstd">implicit</span> <span class="fstd">none</span>
    <span class="fstd">type</span>(<span class="fnv">cudaDeviceProp</span>):: prop
    <span class="fstd">integer</span>:: nDevices=0, i, ierr

    <span class="fcomment">! Number of CUDA-capable devices</span>
    ierr = <span class="fnv">cudaGetDeviceCount</span>(nDevices)

    <span class="fstd">if</span> (nDevices == 0) <span class="fstd">then</span>
        <span class="fstd">write</span>(*,<span class="fstring">"(/, 'No CUDA devices found',/)"</span>)
        stop
    <span class="fstd">else</span> <span class="fstd">if</span> (nDevices == 1) <span class="fstd">then</span>
        <span class="fstd">write</span>(*,<span class="fstring">"(/,'One CUDA device found',/)"</span>)
    <span class="fstd">else</span>
        <span class="fstd">write</span>(*,<span class="fstring">"(/,i0,' CUDA devices found',/)"</span>) nDevices
    <span class="fstd">end</span> <span class="fstd">if</span>

    <span class="fcomment">! Loop over devices and print properties</span>
    <span class="fstd">do</span> i = 0, nDevices-1

        <span class="fstd">write</span>(*,<span class="fstring">"('Device Number: ',i0)"</span>) i

        ierr = <span class="fnv">cudaGetDeviceProperties</span>(prop, i)

        <span class="fcomment">! General device info</span>
        <span class="fstd">write</span>(*,<span class="fstring">"('  Device Name: ',a)"</span>) trim(prop%name)
        <span class="fstd">write</span>(*,<span class="fstring">"('  Compute Capability: ',i0,'.',i0)"</span>) prop%major, prop%minor
        <span class="fstd">write</span>(*,<span class="fstring">"('  Number of Multiprocessors: ',i0)"</span>) prop%maxThreadsPerMultiprocessor
        <span class="fstd">write</span>(*,<span class="fstring">"('  Global Memory (GB): ',f9.3,/)"</span>) prop%totalGlobalMem/1024.**3

        <span class="fcomment">! Execution Configuration</span>
        <span class="fstd">write</span>(*,<span class="fstring">"('  Execution Configuration Limits')"</span>) 
        <span class="fstd">write</span>(*,<span class="fstring">"('    Max Grid Dims: ',2(i0,' x '),i0)"</span>) prop%maxGridSize
        <span class="fstd">write</span>(*,<span class="fstring">"('    Max Block Dims: ',2(i0,' x '),i0)"</span>) prop%maxThreadsDim
        <span class="fstd">write</span>(*,<span class="fstring">"('    Max Threads per Block: ',i0,/)"</span>) prop%maxThreadsPerBlock

    <span class="fstd">end do</span>

<span class="fstd">end</span> <span class="fstd">program</span> deviceQuery</code></pre>
		</div>

		<hr>
		<div class="footer">
			<p>Content first published: 24 Jan 2023 &nbsp;&nbsp;&nbsp; Content last modified: 25 Jan 2023</p>
			<p><a href="mailto:edward_yang_125@hotmail.com"><img src="/static/logos/email.png"> Email</a>&nbsp;&nbsp;&nbsp; <a href="https://www.github.com/edoyango"><img src="/static/logos/github.png"> Github</a>&nbsp;&nbsp;&nbsp; <a href="https://www.linkedin.com/in/edward-yang-a0a9941b1"><img src="/static/logos/linkedin.png"> LinkedIn</a></p>
		</div>
		
	</body>
</html>
